<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>PBX Prompt Builder ‚Äî Prompt utile (anti-cr√©dits)</title>
  <style>
    :root{
      --bg:#F6F7FB;
      --card:#FFFFFF;
      --ink:#0F172A;
      --muted:#64748B;
      --muted2:#94A3B8;
      --line:#E2E8F0;

      --primary:#6D28D9;
      --teal:#14B8A6;

      --good:#22C55E;
      --warn:#F59E0B;
      --bad:#EF4444;

      --shadow: 0 14px 40px rgba(15, 23, 42, 0.10);
      --shadow2: 0 10px 26px rgba(15, 23, 42, 0.07);

      --r:18px;
      --r2:14px;
    }

    *{ box-sizing:border-box; font-family: ui-sans-serif, system-ui, -apple-system, "Segoe UI", sans-serif; }
    body{
      margin:0;
      background:
        radial-gradient(1200px 520px at 15% -10%, rgba(109,40,217,0.16), transparent 55%),
        radial-gradient(1200px 520px at 85% -10%, rgba(20,184,166,0.14), transparent 55%),
        var(--bg);
      color:var(--ink);
      min-height:100vh;
      padding: 20px 14px 46px;
      display:flex;
      justify-content:center;
      align-items:flex-start;
    }

    .wrap{ width:100%; max-width: 1200px; }

    /* Header */
    .top{
      display:flex;
      gap:14px;
      justify-content:space-between;
      align-items:flex-start;
      flex-wrap:wrap;
      margin-bottom: 14px;
    }
    .brand{
      display:flex;
      gap:12px;
      align-items:flex-start;
      min-width: 280px;
      flex: 1 1 740px;
    }
    .logo{
      width:44px; height:44px;
      border-radius: 16px;
      background: linear-gradient(135deg, var(--primary), var(--teal));
      box-shadow: var(--shadow2);
      display:flex;
      align-items:center;
      justify-content:center;
      color:#fff;
      font-weight:950;
      letter-spacing:-0.3px;
      flex-shrink:0;
    }
    h1{
      margin:0;
      font-size: 22px;
      letter-spacing:-0.2px;
      line-height:1.2;
    }
    .sub{
      margin:5px 0 0;
      color: var(--muted);
      font-size: 13px;
      line-height:1.35;
      max-width: 960px;
    }

    .metaPills{
      display:flex;
      gap:10px;
      align-items:center;
      flex-wrap:wrap;
      justify-content:flex-end;
      flex: 1 1 360px;
    }
    .pill{
      display:inline-flex;
      gap:8px;
      align-items:center;
      padding: 10px 12px;
      border: 1px solid var(--line);
      border-radius: 999px;
      background: rgba(255,255,255,0.88);
      box-shadow: 0 10px 22px rgba(15,23,42,0.05);
      font-size: 12.5px;
      color: var(--muted);
      white-space:nowrap;
    }
    .dot{
      width:9px; height:9px; border-radius:999px;
      background: var(--muted2);
    }
    .kbd{
      font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
      font-size: 11.5px;
      padding: 2px 6px;
      border-radius: 8px;
      background: rgba(2,6,23,0.06);
      border: 1px solid rgba(15,23,42,0.10);
      color: #0f172a;
      white-space: nowrap;
    }

    /* Layout */
    .grid{
      display:grid;
      grid-template-columns: 1fr 380px;
      gap: 16px;
      align-items:start;
    }
    @media (max-width: 1020px){
      .grid{ grid-template-columns: 1fr; }
      .side{ position: static !important; }
    }

    .card{
      background: rgba(255,255,255,0.92);
      border: 1px solid var(--line);
      border-radius: var(--r);
      box-shadow: var(--shadow2);
    }
    .card .inner{ padding: 16px; }

    /* Main prompt block */
    .hero{
      border: 1px solid var(--line);
      border-radius: 18px;
      background: rgba(255,255,255,0.78);
      padding: 14px;
      margin-bottom: 12px;
    }
    .heroHead{
      display:flex;
      justify-content:space-between;
      gap:12px;
      align-items:flex-start;
      flex-wrap:wrap;
      margin-bottom: 10px;
    }
    .heroLeft{ display:flex; gap:10px; align-items:flex-start; }
    .heroIcon{
      width:36px; height:36px;
      border-radius: 14px;
      background: linear-gradient(135deg, rgba(109,40,217,0.12), rgba(20,184,166,0.12));
      border: 1px solid rgba(109,40,217,0.18);
      display:flex;
      align-items:center;
      justify-content:center;
      color: var(--primary);
      font-weight: 950;
      flex-shrink:0;
    }
    .heroTitle{ margin:0; font-size: 14px; font-weight: 950; letter-spacing:-0.15px; }
    .heroDesc{ margin:3px 0 0; font-size: 12.5px; color: var(--muted); line-height:1.35; }

    .tags{ display:flex; gap:8px; flex-wrap:wrap; justify-content:flex-end; }
    .tag{
      font-size: 12px;
      padding: 6px 10px;
      border-radius: 999px;
      border: 1px solid var(--line);
      background: #fff;
      color: var(--muted);
      white-space:nowrap;
    }
    .tag.req{
      border-color: rgba(239,68,68,0.22);
      background: rgba(239,68,68,0.06);
      color: #991B1B;
      font-weight: 900;
    }

    .label{
      display:flex;
      justify-content:space-between;
      gap:10px;
      align-items:center;
      flex-wrap:wrap;
      margin: 10px 0 6px;
    }
    .label span{
      font-size: 12.7px;
      font-weight: 950;
      letter-spacing:-0.1px;
    }
    .help{ font-size: 11.7px; color: var(--muted2); }
    .counter{ font-size: 11.7px; color: var(--muted2); white-space:nowrap; }

    textarea, input[type="text"]{
      width:100%;
      border-radius: 14px;
      border: 1px solid var(--line);
      background: rgba(248,250,252,0.85);
      padding: 11px 12px;
      font-size: 13.8px;
      outline:none;
      transition: border-color .15s, box-shadow .15s, background .15s;
      line-height: 1.35;
    }
    textarea{ min-height: 140px; resize: vertical; }
    textarea:focus, input:focus{
      border-color: rgba(109,40,217,0.55);
      box-shadow: 0 0 0 3px rgba(109,40,217,0.18);
      background: #fff;
    }

    .chips{
      display:flex;
      flex-wrap:wrap;
      gap:8px;
      margin-top: 10px;
    }
    .chip{
      border: 1px solid var(--line);
      background: #fff;
      color: var(--ink);
      font-weight: 900;
      font-size: 12.5px;
      padding: 8px 10px;
      border-radius: 999px;
      cursor:pointer;
      user-select:none;
      box-shadow: 0 8px 18px rgba(15,23,42,0.04);
      transition: transform .06s ease, border-color .15s ease;
    }
    .chip:active{ transform: translateY(1px); }
    .chip:hover{ border-color: rgba(109,40,217,0.35); }

    .hint{
      margin-top: 10px;
      padding: 10px 11px;
      border-radius: 14px;
      border: 1px dashed rgba(100,116,139,0.24);
      background: rgba(2,6,23,0.03);
      color: var(--muted);
      font-size: 12px;
      line-height: 1.35;
    }
    .hint strong{ color: var(--ink); }

    /* Advanced */
    details.adv{
      border: 1px solid var(--line);
      border-radius: 18px;
      background: rgba(255,255,255,0.78);
      padding: 10px 12px;
      margin-bottom: 12px;
    }
    details.adv summary{
      cursor:pointer;
      list-style:none;
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
      padding: 6px 4px;
      font-weight: 950;
      letter-spacing:-0.1px;
      font-size: 13px;
    }
    details.adv summary::-webkit-details-marker{ display:none; }
    .advSub{ margin: 4px 4px 10px; color: var(--muted); font-size: 12.2px; line-height:1.35; }

    .row2{ display:grid; grid-template-columns: 1fr 1fr; gap: 10px; }
    @media (max-width: 860px){ .row2{ grid-template-columns: 1fr; } }

    /* Sidebar */
    .side{ position: sticky; top: 14px; }

    .qTop{
      display:flex;
      justify-content:space-between;
      align-items:center;
      gap:12px;
      margin-bottom: 10px;
    }
    .qTop h3{
      margin:0;
      font-size: 14px;
      font-weight: 950;
      letter-spacing:-0.15px;
    }
    .scorePill{
      font-size: 12.5px;
      font-weight: 950;
      padding: 6px 10px;
      border-radius: 999px;
      border: 1px solid var(--line);
      background: #fff;
      color: var(--muted);
      white-space:nowrap;
    }
    .bar{
      height: 10px;
      background: #E2E8F0;
      border-radius: 999px;
      overflow:hidden;
      margin-bottom: 10px;
    }
    .bar > div{
      height: 100%;
      width: 0%;
      background: var(--good);
      transition: width .2s ease, background .2s ease;
    }

    .checks{
      display:grid;
      gap:10px;
      margin-top: 10px;
    }
    .item{
      display:flex;
      gap:10px;
      align-items:flex-start;
      padding: 10px;
      border-radius: 16px;
      border: 1px solid var(--line);
      background: rgba(255,255,255,0.86);
    }
    .ico{
      width:26px; height:26px;
      border-radius:999px;
      display:flex;
      align-items:center;
      justify-content:center;
      color:#fff;
      font-weight: 950;
      flex-shrink:0;
      background: var(--muted2);
    }
    .item.ok .ico{ background: var(--good); }
    .item.warn .ico{ background: var(--warn); }
    .item.bad .ico{ background: var(--bad); }

    .itT{ margin:0; font-size: 12.6px; font-weight: 950; letter-spacing:-0.1px; }
    .itD{ margin: 2px 0 0; font-size: 12px; color: var(--muted); line-height:1.35; }

    .actions{
      display:flex;
      flex-direction:column;
      gap:10px;
      margin-top: 12px;
    }
    .btn{
      border: none;
      border-radius: 16px;
      padding: 11px 12px;
      font-size: 13.7px;
      font-weight: 950;
      cursor:pointer;
      display:flex;
      align-items:center;
      justify-content:center;
      gap:8px;
      transition: transform .06s ease, opacity .15s ease, box-shadow .15s ease;
      user-select:none;
    }
    .btn:active{ transform: translateY(1px); }
    .btn.primary{
      background: linear-gradient(135deg, var(--primary), var(--teal));
      color:#fff;
      box-shadow: 0 14px 30px rgba(109,40,217,0.20);
    }
    .btn.ghost{
      background: #fff;
      border: 1px solid var(--line);
      color: var(--ink);
    }
    .btn.danger{
      background: rgba(239,68,68,0.08);
      border: 1px solid rgba(239,68,68,0.22);
      color: #991B1B;
    }
    .btn[disabled]{ opacity:.45; cursor:not-allowed; box-shadow:none; }

    .mini{
      margin-top: 10px;
      font-size: 12px;
      line-height:1.35;
      color: var(--muted);
    }

    /* Result */
    .resultHead{
      display:flex;
      justify-content:space-between;
      align-items:center;
      gap:10px;
      flex-wrap:wrap;
      margin-bottom: 8px;
    }
    .resultHead h3{
      margin:0;
      font-size: 14px;
      font-weight: 950;
      letter-spacing:-0.15px;
    }
    .badge{
      font-size: 12px;
      padding: 6px 10px;
      border-radius: 999px;
      border: 1px solid var(--line);
      background: #fff;
      color: var(--muted);
      white-space:nowrap;
    }
    #result{
      width:100%;
      min-height: 220px;
      border-radius: 16px;
      border: none;
      outline:none;
      padding: 12px 12px;
      background: #020617;
      color: #E5E7EB;
      font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
      font-size: 12.8px;
      line-height: 1.45;
      white-space: pre-wrap;
    }
    .toast{
      display:none;
      margin-top: 8px;
      padding: 10px 10px;
      border-radius: 14px;
      border: 1px solid rgba(34,197,94,0.25);
      background: rgba(34,197,94,0.08);
      color: #14532D;
      font-weight: 950;
      font-size: 12.5px;
      text-align:center;
    }
  </style>
</head>

<body>
  <div class="wrap">
    <div class="top">
      <div class="brand">
        <div class="logo">PBX</div>
        <div>
          <h1>PBX Prompt Builder ‚Äî minimal & utile</h1>
          <p class="sub">
            Objectif : √©crire <strong>un prompt de variation</strong> actionnable. On bloque la g√©n√©ration tant que le prompt est trop vague (pour √©viter de consommer des cr√©dits pour rien).
          </p>
        </div>
      </div>

      <div class="metaPills">
        <div class="pill"><span class="dot" id="dotState"></span><span id="stateLabel">Prompt incomplet</span></div>
        <div class="pill">Raccourci : <span class="kbd">Ctrl</span> + <span class="kbd">Enter</span></div>
      </div>
    </div>

    <div class="grid">
      <!-- MAIN -->
      <div>
        <div class="card">
          <div class="inner">

            <div class="hero">
              <div class="heroHead">
                <div class="heroLeft">
                  <div class="heroIcon">‚ú¶</div>
                  <div>
                    <p class="heroTitle">Le prompt (c‚Äôest tout ce dont PBX a besoin)</p>
                    <p class="heroDesc">
                      D√©cris <strong>le changement UI</strong> √† appliquer sur la page (front-end). √âvite ‚Äúoptimiser / am√©liorer‚Äù sans pr√©ciser quoi.
                    </p>
                  </div>
                </div>
                <div class="tags">
                  <span class="tag req">Obligatoire</span>
                  <span class="tag">1 prompt = 1 cr√©dit</span>
                </div>
              </div>

              <div class="label">
                <span>What do you want to build or fix ?</span>
                <span class="counter" id="c_prompt"></span>
              </div>
              <textarea id="prompt" placeholder="Ex : Remplace le libell√© du bouton CTA ‚ÄúDemander une d√©mo‚Äù par ‚ÄúVoir les tarifs‚Äù (2‚Äì4 mots, sans emoji), sans changer la mise en page."></textarea>

              <div class="chips" aria-label="Exemples rapides">
                <div class="chip" data-add="Replace the main CTA text with a clearer, shorter label. Keep layout unchanged.">CTA plus clair</div>
                <div class="chip" data-add="Rewrite the hero headline to be more specific and benefit-led. Keep the same length.">Headline plus sp√©cifique</div>
                <div class="chip" data-add="Add a small trust badge next to the main CTA (e.g., 'No credit card'). Keep it subtle and aligned with existing style.">Badge de confiance</div>
                <div class="chip" data-add="Move the primary CTA above the fold within the hero section. Keep styling consistent.">CTA au-dessus du fold</div>
                <div class="chip" data-add="Reduce visual clutter in the pricing card area by simplifying spacing and hierarchy. Do not change content.">Hi√©rarchie pricing</div>
              </div>

              <div class="hint">
                <strong>Checklist mental (1 phrase suffit) :</strong>
                <br>‚Ä¢ <strong>Verbe</strong> (Replace / Add / Remove / Move / Rewrite) + <strong>√©l√©ment</strong> (CTA, H1, badge, input‚Ä¶)
                <br>‚Ä¢ <strong>D√©tails</strong> (texte exact, longueur, style) si n√©cessaire
                <br>‚Ä¢ <strong>Limite</strong> (ne pas changer le layout / ne pas toucher √† X)
              </div>
            </div>

            <details class="adv" id="adv">
              <summary>
                Options avanc√©es (si n√©cessaire)
                <span class="help">r√©duit les it√©rations</span>
              </summary>
              <div class="advSub">
                Ajoute seulement ce qui aide PBX √† ne pas ‚Äúdeviner‚Äù. Sinon laisse vide.
              </div>

              <div class="row2">
                <div>
                  <div class="label">
                    <span>Contraintes / interdits</span>
                    <span class="counter" id="c_constraints"></span>
                  </div>
                  <textarea id="constraints" placeholder="Ex : FR. 2‚Äì4 mots. Pas d‚Äôemoji. Pas de claims non prouvables. Ne pas modifier le layout."></textarea>
                </div>
                <div>
                  <div class="label">
                    <span>Responsive (si tu changes layout)</span>
                    <span class="counter" id="c_responsive"></span>
                  </div>
                  <textarea id="responsive" placeholder="Ex : doit rester clean sur mobile, pas de scroll horizontal, garder la grille existante."></textarea>
                </div>
              </div>

              <div class="row2">
                <div>
                  <div class="label">
                    <span>Format de sortie (rarement utile)</span>
                    <span class="counter" id="c_format"></span>
                  </div>
                  <textarea id="format" placeholder="Ex : Donne 1 r√©sultat final + checklist QA (5 points max)."></textarea>
                </div>
                <div>
                  <div class="label">
                    <span>Si info manquante</span>
                    <span class="help">anti-cr√©dits</span>
                  </div>
                  <input id="missing" type="text" value="If something important is missing, ask up to 3 questions and WAIT." />
                </div>
              </div>
            </details>

            <div class="card">
              <div class="inner">
                <div class="resultHead">
                  <h3>Prompt PBX pr√™t √† coller</h3>
                  <span class="badge" id="genBadge">Incomplet</span>
                </div>
                <textarea id="result" readonly placeholder="Clique ‚ÄúValider‚Äù (questions) ou ‚ÄúG√©n√©rer‚Äù."></textarea>
                <div class="toast" id="toast">Copi√© ‚úÖ</div>
              </div>
            </div>

          </div>
        </div>
      </div>

      <!-- SIDEBAR -->
      <div class="side">
        <div class="card">
          <div class="inner">
            <div class="qTop">
              <h3>Contr√¥le qualit√©</h3>
              <div class="scorePill" id="scorePill">0% ‚õî</div>
            </div>
            <div class="bar"><div id="scoreBar"></div></div>

            <div class="checks" id="checks"></div>

            <div class="actions">
              <button class="btn ghost" id="btnValidate" type="button">üß™ Valider (3 questions max)</button>
              <button class="btn primary" id="btnGenerate" type="button" disabled>‚öôÔ∏è G√©n√©rer le prompt</button>
              <button class="btn ghost" id="btnCopy" type="button" disabled>üìã Copier</button>
              <button class="btn danger" id="btnReset" type="button">üóëÔ∏è R√©initialiser</button>
            </div>

            <div class="mini">
              Le score bloque la g√©n√©ration si le prompt est trop vague (pour √©viter de br√ªler des cr√©dits).
            </div>
          </div>
        </div>
      </div>

    </div>
  </div>

<script>
  const $ = (id) => document.getElementById(id);

  const SKEY = "pbx_minimal_prompt_v1";

  const els = {
    prompt: $("prompt"),
    constraints: $("constraints"),
    responsive: $("responsive"),
    format: $("format"),
    missing: $("missing"),
    adv: $("adv"),

    result: $("result"),
    toast: $("toast"),

    btnValidate: $("btnValidate"),
    btnGenerate: $("btnGenerate"),
    btnCopy: $("btnCopy"),
    btnReset: $("btnReset"),

    scorePill: $("scorePill"),
    scoreBar: $("scoreBar"),
    checks: $("checks"),

    dotState: $("dotState"),
    stateLabel: $("stateLabel"),
    genBadge: $("genBadge"),

    c_prompt: $("c_prompt"),
    c_constraints: $("c_constraints"),
    c_responsive: $("c_responsive"),
    c_format: $("c_format"),
  };

  const vagueMarkers = ["am√©liorer","optimiser","faire mieux","rendre plus","peaufiner","comme tu veux","√† ta guise","peu importe","make it better","optimize"];
  const actionVerbs = ["replace","rewrite","change","add","remove","move","reorder","insert","update","shorten","simplify","highlight","increase","decrease","swap","rename","restyle"];
  const uiKeywords = ["cta","button","headline","h1","title","banner","modal","form","field","input","label","pricing","card","badge","tooltip","navbar","header","footer","hero","copy","text","microcopy"];

  function countChars(v){ return (v || "").trim().length; }
  function setCounter(el, v){ el.textContent = countChars(v) ? `${countChars(v)} car.` : ""; }

  function looksVague(text){
    if(!text) return true;
    const t = text.trim().toLowerCase();
    if(t.length < 40) return true;

    const hasVague = vagueMarkers.some(m => t.includes(m));
    const hasVerb = actionVerbs.some(v => t.includes(v));
    const hasUI = uiKeywords.some(k => t.includes(k));
    const hasConcrete = /["‚Äú‚Äù']|(\d+)|(?:px)|(?:mobile)|(?:desktop)|(?:without changing)|(?:keep layout)|(?:ne pas)/i.test(text);

    // vague if it triggers vague markers OR lacks core structure
    if(hasVague && !hasConcrete) return true;
    if(!hasVerb) return true;
    if(!hasUI && !hasConcrete) return true;
    return false;
  }

  function needsResponsive(text){
    if(!text) return false;
    const t = text.toLowerCase();
    return /(layout|grid|spacing|margin|padding|move|reorder|header|navbar|hero|card)/i.test(t);
  }

  function computeQuality(){
    const missing = [];
    const warnings = [];

    const p = els.prompt.value.trim();
    const c = els.constraints.value.trim();
    const r = els.responsive.value.trim();

    if(!p || p.length < 40){
      missing.push({t:"Prompt non exploitable", d:"Trop court. Ajoute verbe + √©l√©ment + d√©tail.", lvl:"bad"});
    } else if(looksVague(p)){
      missing.push({t:"Prompt trop vague", d:"√âvite ‚Äúoptimiser/am√©liorer‚Äù. Dis quoi changer exactement.", lvl:"bad"});
    } else {
      // ok
    }

    // Reco: constraints
    if(!c){
      warnings.push({t:"Contraintes (reco)", d:"Ajoute 1‚Äì2 r√®gles : langue, longueur, interdits.", lvl:"warn"});
    }

    // Responsive needed when layout-ish
    if(needsResponsive(p) && !r){
      warnings.push({t:"Responsive (reco)", d:"Si tu touches au layout, pr√©cise mobile/desktop.", lvl:"warn"});
    }

    // Score
    let score = 100;
    score -= missing.length * 45;
    score -= warnings.length * 12;
    score = Math.max(0, Math.min(100, score));

    const ready = (missing.length === 0 && score >= 70);
    const state = ready ? "ready" : (score >= 50 ? "warn" : "bad");

    return {score, ready, state, missing, warnings};
  }

  function renderChecks(q){
    const items = [];

    const add = (state, title, desc) => {
      const icon = state === "ok" ? "‚úì" : (state === "warn" ? "!" : "√ó");
      items.push(`
        <div class="item ${state}">
          <div class="ico">${icon}</div>
          <div>
            <p class="itT">${title}</p>
            <p class="itD">${desc}</p>
          </div>
        </div>
      `);
    };

    const p = els.prompt.value.trim();
    const okPrompt = p.length >= 40 && !looksVague(p);
    add(okPrompt ? "ok" : "bad", "Prompt actionnable", okPrompt ? "OK ‚Äî PBX peut ex√©cuter." : "Ajoute verbe + √©l√©ment + d√©tail. Pas ‚Äúoptimiser‚Äù seul.");

    add(els.constraints.value.trim() ? "ok" : "warn", "Contraintes (reco)", els.constraints.value.trim() ? "OK ‚Äî garde-fous pr√©sents." : "Ajoute langue/longueur/interdits pour stabiliser.");

    const respNeeded = needsResponsive(p);
    add(!respNeeded ? "ok" : (els.responsive.value.trim() ? "ok" : "warn"),
        "Responsive",
        !respNeeded ? "N/A ‚Äî pas de changement layout √©vident." : (els.responsive.value.trim() ? "OK ‚Äî mobile/desktop cadr√©." : "Si tu changes le layout, pr√©cise mobile/desktop."));

    add(els.format.value.trim() ? "ok" : "warn", "Format (optionnel)", els.format.value.trim() ? "OK ‚Äî sortie cadr√©e." : "Souvent inutile, mais tu peux demander un output + checklist QA.");

    els.checks.innerHTML = items.join("");
  }

  function updateUI(){
    setCounter(els.c_prompt, els.prompt.value);
    setCounter(els.c_constraints, els.constraints.value);
    setCounter(els.c_responsive, els.responsive.value);
    setCounter(els.c_format, els.format.value);

    const q = computeQuality();

    els.scorePill.textContent = `${q.score}% ${q.ready ? "‚úÖ" : "‚õî"}`;
    els.scoreBar.style.width = `${q.score}%`;

    if(q.state === "ready"){
      els.scoreBar.style.background = "linear-gradient(90deg, #22C55E, #14B8A6)";
      els.dotState.style.background = "var(--good)";
      els.stateLabel.textContent = "Prompt pr√™t";
      els.genBadge.textContent = "PBX-ready";
    } else if(q.state === "warn"){
      els.scoreBar.style.background = "linear-gradient(90deg, #F59E0B, #FBBF24)";
      els.dotState.style.background = "var(--warn)";
      els.stateLabel.textContent = "Presque pr√™t";
      els.genBadge.textContent = "Incomplet";
    } else {
      els.scoreBar.style.background = "linear-gradient(90deg, #EF4444, #F97316)";
      els.dotState.style.background = "var(--bad)";
      els.stateLabel.textContent = "Prompt incomplet";
      els.genBadge.textContent = "Incomplet";
    }

    renderChecks(q);
    els.btnGenerate.disabled = !q.ready;
    els.btnCopy.disabled = !els.result.value.trim();

    save();
    return q;
  }

  function buildQuestions(){
    // max 3, only the essentials, PBX-style
    const p = els.prompt.value.trim();
    const qs = [];

    const add = (q, ex) => {
      if(qs.length >= 3) return;
      qs.push(`- ${q}\n  - Exemple : ${ex}`);
    };

    if(!p || p.length < 40 || looksVague(p)){
      add("Quel est le changement EXACT (verbe + √©l√©ment) ?",
          "‚ÄúReplace the main CTA text with ‚ÄòVoir les tarifs‚Äô, keep layout unchanged.‚Äù");
    }

    // Target clarity if missing UI keyword + no quotes/number
    const lower = p.toLowerCase();
    const hasUI = uiKeywords.some(k => lower.includes(k));
    const hasConcrete = /["‚Äú‚Äù']|(\d+)|(?:px)|(?:ne pas)|(?:keep layout)/i.test(p);
    if(!hasUI && !hasConcrete){
      add("Quel √©l√©ment pr√©cis est modifi√© (CTA, H1, badge, champ‚Ä¶) ?",
          "‚ÄúThe hero H1 headline‚Äù / ‚ÄúThe primary button CTA‚Äù");
    }

    if(!els.constraints.value.trim()){
      add("Quelles contraintes/interdits non n√©gociables ?",
          "‚ÄúFR, 2‚Äì4 words, no emoji, no unprovable claims, do not change layout.‚Äù");
    }

    if(needsResponsive(p) && !els.responsive.value.trim()){
      add("Quelles contraintes responsive (mobile/desktop) ?",
          "‚ÄúNo horizontal scroll on mobile, keep existing grid and spacing.‚Äù");
    }

    if(qs.length === 0){
      qs.push("- Ton prompt est d√©j√† exploitable ‚úÖ");
    }

    return `
üß™ Validation (anti-cr√©dits) ‚Äî questions utiles (max 3)

${qs.join("\n\n")}
`.trim();
  }

  function buildPBXPrompt(){
    const p = els.prompt.value.trim();
    const blocks = [];

    blocks.push(p);

    const c = els.constraints.value.trim();
    const r = els.responsive.value.trim();
    const f = els.format.value.trim();
    const m = els.missing.value.trim();

    if(c) blocks.push(`\nConstraints / avoid:\n${c}`);
    if(r) blocks.push(`\nResponsive:\n${r}`);
    if(f) blocks.push(`\nOutput format:\n${f}`);
    if(m) blocks.push(`\nMissing info policy:\n${m}`);

    // Keep it minimal + explicit about front-end only
    return `Front-end variation only (no back-end changes).\n\n${blocks.join("\n")}`.trim();
  }

  function validate(){
    els.result.value = buildQuestions();
    els.btnCopy.disabled = !els.result.value.trim();
    toast("Questions g√©n√©r√©es ‚úÖ");
  }

  function generate(){
    const q = updateUI();
    if(!q.ready) return;
    els.result.value = buildPBXPrompt();
    els.btnCopy.disabled = !els.result.value.trim();
    toast("Prompt g√©n√©r√© ‚úÖ");
  }

  async function copy(){
    const v = els.result.value.trim();
    if(!v) return;
    try{
      await navigator.clipboard.writeText(v);
      toast("Copi√© ‚úÖ");
    }catch(e){
      els.result.select();
      document.execCommand("copy");
      toast("Copi√© ‚úÖ");
    }
    els.btnCopy.disabled = false;
  }

  function toast(msg){
    els.toast.textContent = msg;
    els.toast.style.display = "block";
    setTimeout(()=> els.toast.style.display="none", 2000);
  }

  function save(){
    const payload = {
      prompt: els.prompt.value,
      constraints: els.constraints.value,
      responsive: els.responsive.value,
      format: els.format.value,
      missing: els.missing.value,
      advOpen: els.adv.open
    };
    try{ localStorage.setItem(SKEY, JSON.stringify(payload)); }catch(e){}
  }

  function load(){
    try{
      const raw = localStorage.getItem(SKEY);
      if(!raw) return;
      const payload = JSON.parse(raw);
      if(payload.prompt != null) els.prompt.value = payload.prompt;
      if(payload.constraints != null) els.constraints.value = payload.constraints;
      if(payload.responsive != null) els.responsive.value = payload.responsive;
      if(payload.format != null) els.format.value = payload.format;
      if(payload.missing != null) els.missing.value = payload.missing;
      if(payload.advOpen != null) els.adv.open = !!payload.advOpen;
    }catch(e){}
  }

  function resetAll(){
    const ok = confirm("R√©initialiser ?");
    if(!ok) return;
    els.prompt.value = "";
    els.constraints.value = "";
    els.responsive.value = "";
    els.format.value = "";
    els.missing.value = "If something important is missing, ask up to 3 questions and WAIT.";
    els.result.value = "";
    els.adv.open = false;
    try{ localStorage.removeItem(SKEY); }catch(e){}
    updateUI();
  }

  // chips
  document.querySelectorAll(".chip").forEach(chip=>{
    chip.addEventListener("click", ()=>{
      const add = chip.getAttribute("data-add") || "";
      if(!add) return;
      if(!els.prompt.value.trim()){
        els.prompt.value = add;
      } else {
        els.prompt.value = (els.prompt.value.trim() + "\n\n" + add).trim();
      }
      els.prompt.focus();
      updateUI();
    });
  });

  // watchers
  ["prompt","constraints","responsive","format","missing"].forEach(id=>{
    $(id).addEventListener("input", updateUI);
    $(id).addEventListener("change", updateUI);
  });

  // buttons
  els.btnValidate.addEventListener("click", validate);
  els.btnGenerate.addEventListener("click", generate);
  els.btnCopy.addEventListener("click", copy);
  els.btnReset.addEventListener("click", resetAll);

  // shortcut Ctrl+Enter (validate if blocked, else generate)
  document.addEventListener("keydown", (e)=>{
    const isMac = navigator.platform.toUpperCase().includes("MAC");
    const ctrl = isMac ? e.metaKey : e.ctrlKey;
    if(ctrl && e.key === "Enter"){
      e.preventDefault();
      const q = updateUI();
      if(q.ready) generate();
      else validate();
    }
  });

  // init
  load();
  updateUI();
</script>
</body>
</html>
